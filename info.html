<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Fauna Tears">
    <meta name="keywords" content="fauna tears, save, endangered species, html, threats, wild life, blue planet, blue planet - wildlife conservation, wildlife conservation">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>Fauna Tears | Species Information</title>

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/flaticon.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.2.0/dist/leaflet.css" />


    <!-- JS Plugin -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/main.js"></script>
    <script src="js/data.js"></script>
    <script src="js/canvasjs.js"></script>
    <script src="js/navigation.js"></script>
    <script>L_PREFER_CANVAS=false; L_NO_TOUCH=false; L_DISABLE_3D=false;</script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>

</head>

<body onload="myFunction()">
    <!-- Page Preloder Begin -->
    <div id="preloder">
        <div class="loader"></div>
    </div>
    <!-- Page Preloder End -->
    <!-- Header Section Begin -->
    <header class="header">
        <a class="logo" href="./home.html">
            <img src="logo.png" alt="">
        </a>
        <input class="menu-btn" type="checkbox" id="menu-btn" />
        <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>
        <ul class="menu">
            <li>
                <a href="./home.html">Home</a>
            </li>
            <li>
                <a href="./map.html">Explore Map</a>
            </li>
            <li>
                <a href="#" onclick="AUS();" class="active">Endangered Species</a>
            </li>
            <li>
                <a href="./index2.html">Threats</a>
            </li>
            <li>
                <a a href="#" onclick="AUS2('Australia');">Get Involved</a>
            </li>
            <li>
                <a href="./about.html">About Us</a>
            </li>
        </ul>
    </header>
    <!-- Header Section End -->
    <!-- Green Border Begin -->
    <section class="hero-section1 home-page set-bg" data-setbg="img/bg.jpg">
        <div class="container hero-text text-white">
            <h2 id="title"></h2>
        </div>
    </section>
    <!-- Green Border End -->
    <!-- Species Information Begin -->
    <section class="property-details">
        <div class="container">
            <!-- 1st Row Begin -->
            <div class="row sp-40 spt-40">
                <!-- 1st Column Begin -->
                <div class="col-lg-12">
                    <div class="p-ins">
                        <!-- 1st Row Begin -->
                        <div class="row details-top">
                            <div class="col-lg-6">
                                <div class="t-details">
                                    <div class="register-id">
                                        <p>Species Name:<span id="info1"></span></p>
                                    </div>

                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="t-details">
                                    <div class="popular-room-features single-property">
                                        <div class="size">
                                            <p>Ranking</p>
                                            <span id="info2"></span>
                                        </div>

                                        <div class="size">
                                            <p>Extinction Rate</p>
                                            <span id="info3"></span>
                                        </div>
                                        <div class="size">
                                            <p>No. of Locations</p>
                                            <span id="info4"></span>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 1st Row End -->
                        <!-- 2nd Row Begin -->
                        <div class="row">
                            <!-- 1st Column Begin -->
                            <div class="col-lg-12">
                                <div class="property-features">
                                    <h4>Biological Information</h4>
                                </div>
                            </div>
                            <div class="col-lg-8">
                                <div class="property-features">
                                    <div class="property-table">
                                        <!-- 1st Table Begin -->
                                        <table>
                                            <!-- 1st Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>Scientific Names:</p>
                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info5"></span>
                                                </td>
                                                <!-- 2nd Column End -->
                                            </tr>
                                            <!-- 1st Row End -->
                                            <!-- 2nd Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>Kingdom:</p>
                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info6"></span>
                                                </td>
                                                <!-- 2nd Column End -->
                                            </tr>
                                            <!-- 2nd Row End -->
                                            <!-- 3rd Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>Phylum:</p>
                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info7"></span>
                                                </td>
                                                <!-- 2nd Column End -->
                                            </tr>
                                            <!-- 3rd Row End -->
                                            <!-- 4th Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>Class:</p>
                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info8"></span>
                                                </td>
                                                <!-- 2nd Column End -->
                                            </tr>
                                            <!-- 4th Row End -->
                                            <!-- 5th Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>Family:</p>
                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info9"></span>
                                                </td>
                                                <!-- 2nd Column End -->
                                            </tr>
                                            <!-- 5th Row End -->
                                            <!-- 6th Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>Genus:</p>
                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info10"></span>
                                                </td>
                                                <!-- 2nd Column End -->
                                            </tr>
                                            <!-- 6th Row End -->
                                            <!-- 7th Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>Taxon Rank:</p>
                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info11"></span>
                                                </td>
                                                <!-- 2nd Column End -->
                                            </tr>
                                            <!-- 7th Row End -->
                                            <!-- 8th Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>Colour:</p>
                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info12"></span>
                                                </td>
                                                <!-- 2nd Column End -->
                                            </tr>
                                            <!-- 8th Row End -->
                                            <!-- 9th Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>Size (cm):</p>
                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info13"></span>
                                                </td>
                                                <!-- 2nd Column End -->
                                            </tr>
                                            <!-- 9th Row End -->
                                            <!-- 10th Row Begin -->
                                            <tr>
                                                <!-- 1st Column Begin -->
                                                <td>
                                                    <p>States Currently Located:</p>

                                                </td>
                                                <!-- 1st Column End -->
                                                <!-- 2nd Column Begin -->
                                                <td>
                                                    <span id="info14"></span>
                                                </td>
                                            </tr>
                                            <!-- 10th Row End -->
                                        </table>
                                        <!-- 1st Table End -->
                                    </div>
                                </div>
                            </div>
                            <!-- 1st Column End -->
                            <!-- 2nd Column Begin -->
                            <div class="col-lg-4 infoimage">

                                <div id="img1"></div>
                            </div>
                            <!-- 2nd Column End -->
                        </div>
                        <!-- 2nd Row End -->
                        <!-- 3rd Row Begin -->
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="property-features">
                                    <h4>Description</h4>
                                    <div class="property-table">
                                        <table>
                                            <tr>
                                                <td>
                                                    <span id="info15"></span>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 3rd Row End -->
                        <!-- 4th Row Begin -->
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="property-features">
                                    <h4>Habitat</h4>
                                    <div class="property-table">
                                        <table>
                                            <tr>
                                                <td>
                                                    <span id="info16"></span>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 4th Row End -->
                        <!-- 5th Row Begin -->
                        <div class="row">
                            <!-- 1st Column Begin -->
                            <div class="col-lg-12">
                                <div class="property-features">
                                    <h4>Decline in the Existence Regions Over the past 5 Decades</h4>
                                    <div class="location-map">
                                        <!-- 1st Column Begin -->
                                        <div class="col-lg-12">
                                            <div id="line-chart"></div>
                                        </div>
                                        <!-- 1st Column End -->
                                    </div>
                                </div>
                                <div class="property-features">
                                    <h4>Current Location(s) of the species</h4>
                                    <p>
                                        Select a location to find out the natural causes that threaten the species habitat.
                                    </p>
                                    <div id="buttons">
                                    </div>
                                    <br />
                                    <div class="location-map">
                                        <!-- 1st Column Begin -->
                                        <div class="col-lg-12">
                                            <div class="folium-map" id="map"></div>
                                        </div>
                                        <!-- 1st Column End -->
                                    </div>
                                </div>
                            </div>
                            <!-- 1st Column End -->
                        </div>
                        <!-- 5th Row End -->
                    </div>
                </div>
                <!-- 1st Column End -->
            </div>
            <!-- 1st Row End -->
        </div>
    </section>
    <!-- Species Information End -->
    <!-- Footer Section Begin -->
    <footer class="footer-section p-40">
        <div class="container">
            <!-- 1st Row Begin -->
            <div class="row">
                <!-- 1st Column Begin -->
                <div class="col-lg-12 text-center">
                    <a href="./home.html">
                        <img src="logo2.png" alt="">
                    </a>
                </div>
                <!-- 1st Column End -->
            </div>
            <!-- 1st Row End -->
            <br />
            <!-- 2nd Row Begin -->
            <div class="row">
                <!-- 1st Column Begin -->
                <div class="col-lg-3">
                </div>
                <!-- 1st Column End -->
                <!-- 2nd Column Begin -->
                <div class="col-lg-2 text-center">
                    <ul class="list-unstyled">
                        <li>
                            <a href="./home.html">Home</a>
                        </li>
                        <li>
                            <a href="./about.html">About Us</a>
                        </li>
                    </ul>
                </div>
                <!-- 2nd Column End -->
                <!-- 3rd Column Begin -->
                <div class="col-lg-2 text-center">
                    <ul class="list-unstyled">
                        <li>
                            <a href="./map.html">Explore Map</a>
                        </li>
                        <li>
                            <a href="#" onclick="AUS();">Endangered Species</a>
                        </li>
                        <li>
                            <a href="./index2.html">Threats</a>
                        </li>
                        <li>
                            <a href="#" onclick="AUS2('Australia');">Get Involved</a>
                        </li>
                    </ul>
                </div>
                <!-- 3rd Column End -->
                <!-- 4th Column Begin -->
                <div class="col-lg-2 text-center">
                    <ul class="list-unstyled">
                        <li>
                            <a href="./terms and conditions.html">Terms of Use</a>
                        </li>
                        <li>
                            <a href="./privacy policy.html">Privacy policy</a>
                        </li>
                    </ul>
                </div>
                <!-- 4th Column End -->
                <!-- 5th Column Begin -->
                <div class="col-lg-3">
                </div>
                <!-- 5th Column End -->
            </div>
            <!-- 2nd Row End -->
        </div>
        <br />
        <!-- 3rd Row Begin -->
        <div class="row p-20">
            <!-- 1st Column Begin -->
            <div class="col-lg-12 text-center copyright">
                <div>
                    Copyright &copy;
                    <script>document.write(new Date().getFullYear());</script>
                    All rights reserved | Fauna Tears
                </div>
            </div>
            <!-- 1st Column End -->
        </div>
        <!-- 3rd Row End -->
    </footer>
    <!-- Footer Section End -->
    <!-- Js Functions -->
    <script type="text/javascript">



        function myFunction() {
        /*
        @author: Ishika Wikramanayake
        @start_date: 27-08-2019
        @end_date: 27-08-2019
        @description: Displays the endangered species information, plots the map and the trend graph
        */
            var species = decodeURIComponent(window.location.search);
            species = species.substring(9);
            document.getElementById("title").innerHTML = species;

            var locations = [];

            for (var i = 0; i < data.length; i++) {
                if (species == data[i]["Vernacular name - original"]){
                    locations.push([data[i]["Latitude"], data[i]["Longitude"], data[i]["Region"]]);
                }
            }

            var bounds = null;
            var avg_lat = 0;
            var avg_lon = 0;
            for (var i = 0; i < locations.length; i++) {
                avg_lat += locations[i][0];
                avg_lon += locations[i][1];
            }
            avg_lat = avg_lat/locations.length;
            avg_lon = avg_lon/locations.length;
            var map = L.map(
                'map', {
                center: [-36.5, 145.5],
                zoom: 6.5,
                maxBounds: bounds,
                layers: [],
                worldCopyJump: false,
                crs: L.CRS.EPSG3857,
                zoomControl: true,
                });

            var tile_layer_34dc1c8b097545c0839c6284f5e8ba08 = L.tileLayer(
                'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                {
                "attribution": null,
                "detectRetina": false,
                "maxNativeZoom": 18,
                "maxZoom": 18,
                "minZoom": 0,
                "noWrap": false,
                "subdomains": "abc"
            }).addTo(map);
                for (var i = 0; i < locations.length; i++) {
                    marker_14e63ebe7611422b82576480cb03a794 = L.marker(
                        [locations[i][0], locations[i][1]],
                        {
                            icon: new L.Icon.Default()
                            }
                        ).bindPopup(locations[i][2]).addTo(map);
                    let isClicked = false

                    marker_14e63ebe7611422b82576480cb03a794.on({
                        mouseover: function() {
                            if(!isClicked) {
                                this.openPopup()
                            }
                        },
                        mouseout: function() {
                            if(!isClicked) {
                                this.closePopup()
                            }
                        },
                        click: function() {
                            isClicked = true
                            this.openPopup()
                        }
                    })

                    map.on ({
                        click: function() {
                            isClicked = false
                        },
                        popupclose: function () {
                            isClicked = false
                        }
                    })
                }

            map.setView(new L.LatLng(-25.2744, 133.7751), 3);

            var name = species.replace('\'', '_');
            var link = "url('images/" + name + ".jpg')";
            document.getElementById("img1").style.content = link;

            var flag = 0;
            unique_scientific = {};
            unique_states = {};

            var y_2018 = 22;
            var y_2008 = 3;
            var y_1998 = 5;
            var y_1988 = 7;
            var y_1978 = 3;
            var y_1968 = 4;

            // display the appropriate details
            for (var i = 0; i < data.length; i++) {
                if (species == data[i]["Vernacular name - original"]) {
                    // if species is found the first time
                    if (flag == 0){
                        document.getElementById("info1").innerHTML = "&nbsp;&nbsp;" + species;
                        document.getElementById("info2").innerHTML = data[i]["Rank"];
                        var rate = parseFloat(data[i]["Rate"]) * -1;
                        rate = String(rate);
                        rate = rate.slice(0, 5) + "%";
                        document.getElementById("info3").innerHTML = rate;
                        document.getElementById("info4").innerHTML = data[i]["2019"];
                        document.getElementById("info5").innerHTML = data[i]["Scientific Name"];
                        document.getElementById("info6").innerHTML = data[i]["Kingdom"];
                        document.getElementById("info7").innerHTML = data[i]["Phylum"];
                        document.getElementById("info8").innerHTML = data[i]["Class"];
                        document.getElementById("info9").innerHTML = data[i]["Family"];
                        document.getElementById("info10").innerHTML = data[i]["Genus"];
                        document.getElementById("info11").innerHTML = data[i]["Taxon Rank"];
                        document.getElementById("info12").innerHTML = data[i]["Colour"];
                        document.getElementById("info13").innerHTML = data[i]["Size (cm)"];
                        document.getElementById("info14").innerHTML = data[i]["State - parsed"];
                        document.getElementById("info15").innerHTML = data[i]["Description"];
                        document.getElementById("info16").innerHTML = data[i]["Habitat"];

                        y_2018 = data[i]["2018"];
                        y_2008 = data[i]["2008"];
                        y_1998 = data[i]["1998"];
                        y_1988 = data[i]["1988"];
                        y_1978 = data[i]["1978"];
                        y_1968 = data[i]["1968"];
                        flag = 1;

                        unique_scientific[data[i]["Scientific Name"]] = 1;
                        unique_states[data[i]["State - parsed"]] = 1;
                    }
                    else {

                        // get all the scientific names
                        if (data[i]["Scientific Name"] in unique_scientific){
                            unique_scientific[data[i]["Scientific Name"]] += 1;
                        }
                        else{
                            document.getElementById("info5").innerHTML += ", " + data[i]["Scientific Name"];
                            unique_scientific[data[i]["Scientific Name"]] = 1;
                        }

                        // get all the locations
                        if (data[i]["State - parsed"] in unique_states){
                            unique_states[data[i]["State - parsed"]] += 1;
                        }
                        else{
                            document.getElementById("info10").innerHTML += ", " + data[i]["State - parsed"];
                            unique_states[data[i]["State - parsed"]] = 1;
                        }
                    }

                }
            }

            var regions = document.getElementById("buttons");
            unique_regions = {};
            var newlist = data.sort((a, b) => (a["Region"] > b["Region"]) ? 1 : -1);
            for (var i = 0; i < newlist.length; i++) {
                if (species == newlist[i]["Vernacular name - original"]) {
                    if (newlist[i]["Region"] in unique_regions){
                        unique_regions[newlist[i]["Region"]] += 1;
                    }
                    else{
                        var button = document.createElement("button");
                        button.innerHTML = newlist[i]["Region"];
                        button.setAttribute("id", newlist[i]["Region"]);
                        button.onclick = function() {
                            var value = this.id;
                            window.location.href = "causes.html?region="+value;
                        };
                        unique_regions[newlist[i]["Region"]] = 1;
                        regions.appendChild(button);
                    }
                }
            }



            // create trend chart
            var chart = new CanvasJS.Chart("line-chart", {
                animationEnabled: true,
                //theme: "light2",
                axisX: {
                    title: "Year"
                },
                axisY: {
                    title: "Number of Locations"
                },
                toolTip:{
                   content:"<span style='\"'color: #5F8968;'\"'>{label}</span>: {y}"
                },
                data: [{
                    markerColor: "#5F8968",
                    lineColor: "#5F8968",
                    type: "line",
                    dataPoints: [
                        { y: y_1968, label: "1968"},
                        { y: y_1978, label: "1978"},
                        { y: y_1988, label: "1988"},
                        { y: y_1998, label: "1998"},
                        { y: y_2008, label: "2008" },
                        { y: y_2018, label: "2018"}
                    ]
                }]

            });
            chart.render();

        }
    </script>
</body>
</html>
